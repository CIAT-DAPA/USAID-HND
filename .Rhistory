stName
stDpto
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
merge
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
merge
stCode <- paste(merge$COD_NAC)
stCode
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t")
}
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stLs <- list.files(iDir, pattern = "xlsx")
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t")
}
## Carlos Navarro
## CIAT-CCAFS
## February 2017
## USAID-HND
## Needs java x-64 (if R is 64bits) https://www.java.com/en/download/manual.jsp
Sys.setenv(JAVA_HOME='C:/Program Files/Java/jre1.8.0_121')
library(rgdal)
library(proj4)
library(XLConnect)
# Convert formats
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
# List of the stations in xlsx format
stLs <- list.files(iDir, pattern = "xlsx")
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t")
}
## Carlos Navarro
## CIAT-CCAFS
## February 2017
## USAID-HND
## Needs java x-64 (if R is 64bits) https://www.java.com/en/download/manual.jsp
Sys.setenv(JAVA_HOME='C:/Program Files/Java/jre1.8.0_121')
library(rgdal)
library(proj4)
library(XLConnect)
# Convert formats
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
# List of the stations in xlsx format
stLs <- list.files(iDir, pattern = "xlsx")
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t")
}
## Carlos Navarro
## CIAT-CCAFS
## February 2017
## USAID-HND
## Needs java x-64 (if R is 64bits) https://www.java.com/en/download/manual.jsp
Sys.setenv(JAVA_HOME='C:/Program Files/Java/jre1.8.0_121')
library(rgdal)
library(proj4)
library(XLConnect)
# Convert formats
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
# List of the stations in xlsx format
stLs <- list.files(iDir, pattern = "xlsx")
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t")
}
## Carlos Navarro
## CIAT-CCAFS
## February 2017
## USAID-HND
## Needs java x-64 (if R is 64bits) https://www.java.com/en/download/manual.jsp
Sys.setenv(JAVA_HOME='C:/Program Files/Java/jre1.8.0_121')
library(rgdal)
library(proj4)
library(XLConnect)
# Convert formats
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
# List of the stations in xlsx format
stLs <- list.files(iDir, pattern = "xlsx")
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
}
st <- stLs[34]
st
st <- stLs[33]
st
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
write.csv(cat_sel, "W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2_sel.csv", quote = F, row.names = F)
cat_sel <- c()
for (st in stLs){
stName <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
write.csv(cat_sel, "W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2_sel.csv", quote = F, row.names = F)
Sys.setenv(JAVA_HOME='C:/Program Files/Java/jre1.8.0_121')
library(rgdal)
library(proj4)
library(XLConnect)
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files/2da_parte"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stLs <- list.files(iDir, pattern = "xlsx")
cat_sel <- c()
stLs
st <- stLs[1]
st
stLs <- list.files(iDir, pattern = "xlsx")
st <- stLs[1]
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " ( ")[[1]][1])
stLs
st <- stLs[26]
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " ( ")[[1]][1])
iconv(st, to='ASCII//TRANSLIT')
strsplit(iconv(st, to='ASCII//TRANSLIT'), " ( ")
strsplit(iconv(st, to='ASCII//TRANSLIT'), " -  ")
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "(")[[1]][1])
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), '(')[[1]][1])
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), '\d')[[1]][1])
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "\d")[[1]][1])
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), ":(:")[[1]][1])
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
stName_prev
stName <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stName
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName_prev
st <- stLs
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stName
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[: (:]")[1])
stName_prev
st <- stLs
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[: (:]")[1])
stName_prev
st <- stLs
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName_prev
st <- stLs[1]
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName_prev
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), ".")[[1]][1])
stName_prev
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev
as.data.frame(st)
st <- stLs
st <- stLs
as.data.frame(st)
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[1])
stName_prev
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]])
stName_prev
stLs <- list.files(iDir, pattern = "xlsx")
stLs
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
st
st
st <- stLs[1]
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), " - ")[[1]][1])
stName
stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
stDpto
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & tolower(iconv(stcat$DEPTO, to='ASCII//TRANSLIT')) == stDpto) & stcat$INSTITUCIO == "ENEE", ]
merge
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE", ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
write.csv(cat_sel, "W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2_sel.csv", quote = F, row.names = F)
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
merge
stCode <- paste(merge$COD_NAC)
stCode
cat(stName, "\t",stCode, "\n")
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
st <- stLs[11]
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[: (:]")[[1]][1])
stName_prev
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
stName_prev
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
stName <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
substring(stName_prev, nchar(stName_prev)-1,nchar(stName_prev))
stName_prev
trim.trailing <- function (x) sub("\\s+$", "", x)
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
stName_prev
trim.trailing(stName_prev)
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
stName
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files/2da_parte"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stLs <- list.files(iDir, pattern = "xlsx")
cat_sel <- c()
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
stLs
st <- stLs[32]
st
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
stName_prev
trim.trailing <- function (x) sub("\\s+$", "", x)
trim.trailing(stName_prev)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
stName
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
merge
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files/2da_parte"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stLs <- list.files(iDir, pattern = "xlsx")
cat_sel <- c()
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
merge
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
stLs <- list.files(iDir, pattern = "xlsx")
cat_sel <- c()
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files/2da_parte"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
stLs <- list.files(iDir, pattern = "xlsx")
cat_sel <- c()
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
# stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
# write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
write.csv(cat_sel, "W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v3_sel.csv", quote = F, row.names = F)
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
write.csv(cat_sel, "W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v3_sel.csv", quote = F, row.names = F)
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet ="Diaria", header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
loadWorkbook?
?loadWorkbook
?readWorksheet
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet =1, header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
# Convert formats
iDir <- "W:/01_weather_stations/hnd_enee/daily_raw/_primary_files/2da_parte"
stcat <- read.csv("W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v2.csv")
# List of the stations in xlsx format
stLs <- list.files(iDir, pattern = "xlsx")
cat_sel <- c()
for (st in stLs){
stName_prev <- tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), "[:.:]")[[1]][1])
stName_prev <- tolower(strsplit(iconv(stName_prev, to='ASCII//TRANSLIT'), "[:(:]")[[1]][1])
trim.trailing <- function (x) sub("\\s+$", "", x)
stName <- tolower(strsplit(iconv(trim.trailing(stName_prev), to='ASCII//TRANSLIT'), " - ")[[1]][1])
# stDpto <- gsub(pattern = "\\.xlsx$", "", tolower(strsplit(iconv(st, to='ASCII//TRANSLIT'), " - ")[[1]][2]))
# Merge with the catalog
merge <- stcat[which(tolower(iconv(stcat$Estacion, to='ASCII//TRANSLIT')) == stName & stcat$INSTITUCIO == "ENEE"), ]
stCode <- paste(merge$COD_NAC)
cat(stName, "\t",stCode, "\n")
stRead <- readWorksheet(loadWorkbook(paste0(iDir, "/", st)), sheet =1, header = T)
write.table(stRead, paste0(iDir, "/", stCode, ".txt"), quote = F, row.names = F, sep="\t", na = "")
#
cat_sel <- rbind(cat_sel, merge)
}
write.csv(cat_sel, "W:/01_weather_stations/hnd_enee/daily_raw/stations_catalog_v3_sel.csv", quote = F, row.names = F)
